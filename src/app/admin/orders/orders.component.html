<header class="dashboard-header">
    <h1>Order Management</h1>
    <p>View and manage all customer orders.</p>
</header>

<div class="orders-layout">
    <section class="dashboard-card">
        <div class="card-header">
            <h2>All Orders</h2>
            <div class="filter-bar">
                <button (click)="filterOrders('All')" [class.active]="currentFilter === 'All'">All</button>
                <button (click)="filterOrders('Pending')" [class.active]="currentFilter === 'Pending'">Pending</button>
                <button (click)="filterOrders('Shipped')" [class.active]="currentFilter === 'Shipped'">Shipped</button>
                <button (click)="filterOrders('Completed')"
                    [class.active]="currentFilter === 'Completed'">Completed</button>
                <button (click)="filterOrders('Failed')" [class.active]="currentFilter === 'Failed'">Failed</button>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Customer</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let order of filteredOrders" (click)="selectOrder(order)"
                        [class.selected]="selectedOrder?.id === order.id">
                        <td>{{ order.id }}</td>
                        <td>{{ order.customerName }}</td>
                        <td>{{ order.date | date:'medium' }}</td>
                        <td><span class="status-badge status-{{ order.status.toLowerCase() }}">{{ order.status }}</span>
                        </td>
                        <td>{{ order.total | currency }}</td>
                    </tr>
                    <tr *ngIf="filteredOrders.length === 0">
                        <td colspan="5" class="empty-state-row">No orders found for this filter.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <section class="dashboard-card order-details-card" *ngIf="selectedOrder">
        <div class="card-header">
            <h2>Order Details</h2>
            <button class="close-btn" (click)="clearSelection()" title="Close">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <div class="details-content">
            <div class="detail-group">
                <span class="detail-label">Order ID</span>
                <span class="detail-value">{{ selectedOrder.id }}</span>
            </div>
            <div class="detail-group">
                <span class="detail-label">Customer</span>
                <span class="detail-value">{{ selectedOrder.customerName }}</span>
                <span class="detail-sub-value">{{ selectedOrder.customerEmail }}</span>
            </div>
            <div class="detail-group">
                <span class="detail-label">Order Date</span>
                <span class="detail-value">{{ selectedOrder.date | date:'full' }}</span>
            </div>
            <div class="detail-group">
                <label for="status-update" class="detail-label">Status</label>
                <div class="status-update-wrapper">
                    <select id="status-update" [ngModel]="selectedOrder.status"
                        (ngModelChange)="updateOrderStatus($event)">
                        <option *ngFor="let status of orderStatuses" [value]="status">{{ status }}</option>
                    </select>
                </div>
            </div>

            <h3>Items in Order</h3>
            <ul class="item-list">
                <li *ngFor="let item of selectedOrder.items">
                    <div class="item-info">
                        <span class="item-name">{{ item.toolName }} (x{{ item.quantity }})</span>
                        <span class="item-price">{{ item.price * item.quantity | currency }}</span>
                    </div>
                </li>
            </ul>

            <div class="order-total">
                <span>Total</span>
                <span>{{ selectedOrder.total | currency }}</span>
            </div>
        </div>
    </section>

    <section class="dashboard-card empty-details" *ngIf="!selectedOrder">
        <h2>Select an Order</h2>
        <p>Click on an order from the list to view its details here.</p>
        <div class="placeholder-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect width="20" height="14" x="2" y="7" rx="2" ry="2" />
                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
            </svg>
        </div>
    </section>
</div>

<section class="dashboard-card downloads-card">
    <h2>Recent Downloads</h2>
    <div class="downloads-list">
        <div class="download-item" *ngFor="let download of downloadActivities">
            <div class="download-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7 10 12 15 17 10" />
                    <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
            </div>
            <div class="download-info">
                <p><strong>{{ download.customerName }}</strong> downloaded <strong>{{ download.toolName }}</strong>.</p>
                <small>From Order: {{ download.orderId }} | {{ download.downloadDate | date:'short' }}</small>
            </div>
        </div>
        <div *ngIf="downloadActivities.length === 0" class="empty-state">
            <p>No recent download activity.</p>
        </div>
    </div>
</section>